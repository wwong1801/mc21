<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>21ç‚¹ Â· Player Turn (v0.2.0)</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <main class="table" aria-live="polite">
    <header class="bar">
      <h1>ğŸƒ 21ç‚¹ Â· Player Turn</h1>

      <!-- Add inside <header class="bar"> ... -->
      <div class="bet">
        <label for="betInput">ä¸‹æ³¨</label>
        <input id="betInput" type="number" min="1" step="1" value="100" style="width:90px" />
      </div>
      
      <div class="controls">
        <button id="newBtn" class="primary" title="N">æ–°ä¸€å±€ (N)</button>
        <button id="hitBtn" title="H">è¦ç‰Œ (H)</button>
        <button id="standBtn" class="danger" title="S">ä¸è¦ (S)</button>
      </div>
    </header>

    <section class="row">
      <div class="zone" id="dealerZone">
        <h2>åº„å®¶ï¼ˆéšè—ï¼‰</h2>
        <div id="dealerHand" class="hand"></div>
        <div id="dealerTotal" class="total">ç‚¹æ•°ï¼šâ€”ï¼ˆæœªå…¬å¼€ï¼‰</div>
      </div>

      <div class="zone" id="playerZone">
        <h2>ç©å®¶</h2>
        <div id="playerHand" class="hand"></div>
        <div id="playerTotal" class="total">ç‚¹æ•°ï¼š0</div>
        <div id="banner" class="banner" hidden></div>
      </div>
    </section>
  </main>
<div style="display:flex;gap:8px;margin:8px 0;">
  <button onclick="window.__test('deal')">Test deal</button>
  <button onclick="window.__test('win')">Test win</button>
  <button onclick="window.__test('lose')">Test lose</button>
</div>
<script>
  window.__test = (name) => { 
    console.log('TEST sfx:', name);
    try { sfx.play(name); } catch(e) { console.log(e); }
  };
</script>

  <!-- DIRECT RAW AUDIO TEST (bypass sfx helper) -->
<div style="display:flex;gap:8px;margin:8px 0;">
  <button onclick="new Audio('./sounds/deal.mp3').play()">ğŸ”Š Raw Deal</button>
  <button onclick="new Audio('./sounds/win.mp3').play()">ğŸ”Š Raw Win</button>
  <button onclick="new Audio('./sounds/lose.mp3').play()">ğŸ”Š Raw Lose</button>
</div>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
  import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  // â¬‡ï¸ Replace with your config from Firebase console (Web app settings)
  const firebaseConfig = {
    apiKey: "AIzaSyAIro5ymv33s82pZQYuNV_8Uo4TzOp4Fe8",
    authDomain: "mc21-8e9d1.firebaseapp.com",
    projectId: "mc21-8e9d1",
    storageBucket: "mc21-8e9d1.firebasestorage.app",
    messagingSenderId: "32721916885",
    appId: "1:32721916885:web:7731d35283c3e91995a35c"
  };

  // Init
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // Sign in anonymously (so writes are associated to a uid)
  await signInAnonymously(auth);

  // Expose a tiny helper for your game to save rounds later
  window.saveRound = async (round) => {
    try {
      const uid = auth.currentUser?.uid || null;
      await addDoc(collection(db, "rounds"), {
        uid,
        bet: round.bet,
        delta: round.delta,
        outcome: round.outcome, // e.g. "P_NORMAL_WIN"
        pt: round.pt,
        dt: round.dt,
        player: round.player,   // e.g. ["AS","KD"]
        dealer: round.dealer,
        createdAt: serverTimestamp(),
      });
      // console.log("round saved");
    } catch (e) {
      console.error("saveRound error", e);
    }
  };

  // Quick test button (remove later)
  window.testSave = async () => {
    await window.saveRound?.({
      bet: 100, delta: +100, outcome: "TEST_WIN",
      pt: 21, dt: 18, player: ["Aâ™ ","Kâ™¦"], dealer: ["10â™£","8â™¥"]
    });
    alert("Test round saved (check Firestore/rounds).");
  };
</script>

<!-- TEMP test UI -->
<button onclick="window.testSave()" style="margin:8px 0">Save TEST round</button>
  
  <script type="module" src="./src/game.js"></script>
</body>
</html>
